# CodeDi ??????????????????????[English](https://github.com/liuzhenyulive/CodeDi/blob/master/README.md)
[![Build status](https://ci.appveyor.com/api/projects/status/eeo8aua4n8r5fnce?svg=true)](https://ci.appveyor.com/project/liuzhenyulive/codedi)
[![NuGet](https://img.shields.io/badge/nuget-1.0.1-blue.svg)](https://www.nuget.org/packages/CodeDI/)
[![GitHub license](https://img.shields.io/badge/license-MIT-blue.svg)](https://raw.githubusercontent.com/liuzhenyulive/codedi/master/LICENSE)

CodeDi????? .Net Standard????,??????????Asp .net core?? .net core??????????.

- [CodeDi](#codedi)
- [Overview](#overview)
- [Getting Started](#getting-started)
  - [Install NuGet Package](#install-nuget-package)
  - [Add CodeDi to ConfigureServices](#add-codedi-to-configureservices)
    - [Options 1](#options-1)
    - [Options 2](#options-2)
    - [Options 3](#options-3)
  - [CodeDiOptions](#codedioptions)
- [License](#license)



## Overview

CodeDi ? Code Dependency Injection???,???????????????,????????????????????ServiceCollection?,???????????,????????????????????.?????????????[<.NET Core??????????????????????????>](https://www.cnblogs.com/yilezhu/p/10236163.html ".NET Core??????????????????????????")?,???????????????????????,??????????????,???????????????.



## Getting Started

### ??Nuget?

CodeDi?Nuget???????nuget.org,?????????????????CodeDi

```
PM> Install-Package CodeDi
```
### ConfigureServices????
#### ?? 1
????`Startuo`?`ConfigureService`?????AddCodeDi???CodeDi???.????????CodeDi???????.
```
        public void ConfigureServices(IServiceCollection services)
        {
            services.AddCoreDi();
            services.AddMvc();
        }
```
#### ?? 2
?????AddCodeDi???????`Action<CodeDiOptions>`??,???action?,????CodeDiOptions???????.
```
       public void ConfigureServices(IServiceCollection services)
        {
            services.AddCoreDi(options =>
            {
                options.DefaultServiceLifetime = ServiceLifetime.Scoped;

            });
            services.AddMvc();
        }
```
#### ?? 3
?????????`AddCodeDi()`????????`CodeDiOptions`??.
```
        public void ConfigureServices(IServiceCollection services)
        {
            services.AddCoreDi(new CodeDiOptions()
            {
                DefaultServiceLifetime = ServiceLifetime.Scoped
            });
            services.AddMvc();
        }
```
You can also configure the Options information into the appsettings.json file and then bind the data to the CodeDiOptions parameter.
?????`appsetting.json`?????`CodeDiOptions`???,???`Configuration.Bind("CodeDiOptions", options)`??????????`CodeDiOptions`??.

appsetting.json file
```
{
  "Logging": {
    "LogLevel": {
      "Default": "Warning"
    }
  },
  "AllowedHosts": "*",
  "CodeDiOptions": {
    "DefaultServiceLifetime": 1,
    "AssemblyNames": [
      "*CodeDi"
    ],
    "AssemblyPaths": [
      "C:\\MyBox\\Github\\CodeDI\\CodeDI\\bin\\Debug\\netstandard2.0"
    ],
    "IgnoreAssemblies": [
      "*Test"
    ],
    "IncludeSystemAssemblies": false,
    "IgnoreInterface": [
      "*Say"
    ],
    "InterfaceMappings": {
      "*Say": "*English"
    },
    "ServiceLifeTimeMappings": {
      "*Say": 0
    }
  }
}

```
ConfigureService??
```
        public void ConfigureServices(IServiceCollection services)
        {
            var options=new CodeDiOptions();
            Configuration.Bind("CodeDiOptions", options);
            services.AddCoreDi(options);
            services.AddMvc();
        }
```

### CodeDiOptions??
| ????  | ????  | ???? | ???  |
| :------------: | :------------: | :------------: | :------------: |
| AssemblyPaths  | ????????Dll???  |  string[] | Bin??  |
| AssemblyNames  | ??????????? (?????)  | string[]  |  * |
| IgnoreAssemblies | ???????? (?????)  |   string[]|  null |
| IncludeSystemAssemblies  |  ?????????(??false?,?????System,Microsoft,CppCodeProvider,WebMatrix,SMDiagnostics,Newtonsoft?????App_Web,App_global???????) |  bool | false  |
| IgnoreInterface  |  ????? (?????) | string[]  |  null |
| InterfaceMappings  | ??????? (?????) ,???????????,???????,??????????SerciceCollection? | Dictionary<string, string>  |  null |
| DefaultServiceLifetime  |  ????????? | ServuceLifetime( Singleton,Scoped,Transient)  |  ServiceLifetime.Scope |
| ServiceLifeTimeMappings  | ?????????????,???????????  |  Dictionary<string, ServiceLifetime> | null  |



?? `ISay` ???`SayInChinese` ?`SayInEnglish` ????,?????SayInEnglish???`ServiceCollection`?

```
 public interface ISay
    {
        string Hello();
    }

      public class SayInChinese:ISay
    {
        public string Hello()
        {
            return "你好";
        }
    }

        public class SayInEnglish:ISay
    {
        public string Hello()
        {
            return "Hello";
        }
    }

```
??????????`InterfaceMappings`.

options.InterfaceMappings=new Dictionary<string, string>(){{ "*Say", "*Chinese" } }

??????ISay???????????`Singleton`,????????`ServiceLifeTimeMappings`.

options.ServiceLifeTimeMappings = new Dictionary<string, ServiceLifetime>(){{"*Say",ServiceLifetime.Singleton}};

??ServiceLifetime: https://github.com/aspnet/DependencyInjection/blob/master/src/DI.Abstractions/ServiceLifetime.cs



### ??????
??, ????????,???????????????,???????????????????ServiceCollection?,??????????,????`ICodeDiServiceProvider` ??????????.


??,? `ISay` ??? `SayInChinese` ? `SayInEnglish`????, ???????????????????

```
 public interface ISay
    {
        string Hello();
    }

      public class SayInChinese:ISay
    {
        public string Hello()
        {
            return "你好";
        }
    }

        public class SayInEnglish:ISay
    {
        public string Hello()
        {
            return "Hello";
        }
    }

```

```
 public class HomeController : Controller
    {
        private readonly ISay _say;

        public HomeController(ICodeDiServiceProvider serviceProvider)
        {
            _say = serviceProvider.GetService<ISay>("*Chinese");
        }

        public string Index()
        {
            return _say.Hello();
        }
    }

```
`ICodeDiServiceProvider.GetService<T>(string name=null)`
????Name?????.

### Engoy it!

???CodeDi?,?????????????????????,??????????,?????????Add?ServiceCollection??,??????????!


### License

[MIT](https://raw.githubusercontent.com/liuzhenyulive/codedi/master/LICENSE)
